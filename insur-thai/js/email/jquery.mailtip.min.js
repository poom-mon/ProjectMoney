!function(e){function t(e,t){var i=/[\^\.\\\|\(\)\*\+\-\$\[\]\?]/gim;return e=e.replace(i,function(e){return"\\"+e}),new RegExp(e,t)}var i="oninput"in document.createElement("input"),a=/MSIE 9.0;/i.test(navigator.appVersion||""),o=function(t,i){var a=null;if(!t.data("data-mailtip")){var o=t.parent();!/absolute|relative/i.test(o.css("position"))&&o.css("position","relative"),t.attr("autocomplete","off");var n=t.offset(),s=o.offset();a=e('<ul class="mailtip" style="display: none; float: none; position:absolute; margin: 0; padding: 0; z-index: '+i.zindex+'"></ul>'),t.after(a),a.css({top:n.top-s.top+t.outerHeight()+i.offsettop,left:n.left-s.left+i.offsetleft,width:i.width||t.outerWidth()-a.outerWidth()+a.width()}),a.delegate("li","mouseenter mouseleave click",function(a){switch(a.type){case"mouseenter":e(this).addClass("hover");break;case"click":var o=e(this).attr("title");t.val(o).focus(),i.afterselect.call(t[0],o);break;case"mouseleave":e(this).removeClass("hover")}}),e(document).bind("click",function(e){e.target!==t[0]&&a.hide()}),t.data("data-mailtip",a)}return a||t.data("data-mailtip")},n=function(e,i){var a="",o=/@/.test(e);if(o){var n=e.split("@");if(n.length>2)return a;e=n[0];var s=t("@"+n[1],"i")}e=o?e.split("@")[0]:e;for(var l=0,r=i.length;r>l;l++)(!o||s.test(i[l]))&&(a+='<li title="'+e+i[l]+'" style="margin: 0; padding: 0; float: none;"><p>'+e+i[l]+"</p></li>");return a.replace(/^<li([^>]*)>/,'<li$1 class="active">')},s=function(e,t){if("none"!==e.css("display")){var i=e.find("li.active");if(t){var a=i.prev();a=a.length?a:e.find("li:last"),i.removeClass("active"),a.addClass("active")}else{var o=i.next();o=o.length?o:e.find("li:first"),i.removeClass("active"),o.addClass("active")}}},l=function(e,t,i){if(!e||/[,]|[\u4e00-\u9fa5]|\s|^@/.test(e)||e.split("@").length>2)t.hide();else{var a=n(e,i);a?t.html(a).show():t.hide()}};e.fn.mailtip=function(t){var n={mails:["@gmail.com","@hotmail.com","@hotmail.co.th","@yahoo.com","@live.com","@msn.com","@windowslive.com"],afterselect:e.noop,width:null,offsettop:0,offsetleft:0,zindex:1e3};return t=e.extend({},n,t),t.afterselect="function"==typeof t.afterselect?t.afterselect:n.afterselect,t.width="number"==typeof t.width?t.width:n.width,t.offsettop="number"==typeof t.offsettop?t.offsettop:n.offsettop,t.offsetleft="number"==typeof t.offsetleft?t.offsetleft:n.offsetleft,t.zindex="number"==typeof t.zindex?t.zindex:n.zindex,this.each(function(){var n=e(this),r=o(n,t);n.bind("keydown input propertychange",function(a){if("keydown"===a.type)switch(a.keyCode){case 8:e.browser.msie&&e.browser.version>=9&&n.trigger("input");break;case 9:r.hide();break;case 38:s(r,!0);break;case 40:s(r);break;case 13:if("none"===r.css("display"))return;a.preventDefault();var o=r.find("li.active").attr("title");n.val(o).focus(),r.hide(),t.afterselect.call(n[0],o)}else i?l(n.val(),r,t.mails):"value"===a.originalEvent.propertyName&&l(n.val(),r,t.mails)}),a&&n.on("keyup",function(e){8===e.keyCode&&l(n.val(),r,t.mails)})})}}(jQuery);